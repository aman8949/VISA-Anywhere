{% extends 'shop/basic.html' %}
{% block title%} Visa Anywhere{% endblock %}
{% block body %}
<div class="container my-3">
    <h2>Merchants Nearby Your Location...</h2>
    <table class="table table-hover my-4">
        <thead>
          <tr>
            <th scope="col">Merchant Name</th>
            <th scope="col">Address</th>
          </tr>
        </thead>
        <tbody>
          {% for x in merchant_list %}
                <tr>
                    <td><a href="{% url 'shop:product_list' x.id %}">{{x.name}}</a></td>
                    <td><a href="{% url 'shop:product_list' x.id %}">{{x.address}}</a></td>
                  </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>
{% endblock %}

{% block js %}
<script>
    // Find out the cart items from localStorage
    if (localStorage.getItem('cart') == null) {
        var cart = {};
    } else {
        cart = JSON.parse(localStorage.getItem('cart'));
        document.getElementById('cart').innerHTML = Object.keys(cart).length;
        updateCart(cart);
    }
    //Add Popover to cart
    $('#popcart').popover();
    updatePopover(cart);
    
    function updatePopover(cart){
        var popStr="";
        popStr=popStr + "<h6>Items in your cart</h6><div class='mx-2 my-2'>";
        var i=1;
        for(var item in cart){
            popStr=popStr + "<b>"+ i + "</b>. ";
            popStr=popStr+cart[item][1] + "... Qty: "+ cart[item][0]+ '<br>';
            i=i+1;
        }
        popStr=popStr+"</div><a href='/shop/checkout'><button id='checkout' class='btn btn-primary'>Checkout</button></a> <button id='clearCart' onclick='clearCart()' class='btn btn-primary'>Clear Cart</button>";
        document.getElementById("popcart").setAttribute('data-content', popStr);
        $('#popcart').popover('show');
    }
    function updateCart(cart) {
        localStorage.setItem('cart', JSON.stringify(cart));
        var count=0;
        for(var i=0;i<Object.keys(cart).length;i++)
        count=count+Object.values(cart)[i][0];
        document.getElementById('cart').innerHTML = count;
        updatePopover(cart);
    }
    function clearCart(){
        cart=JSON.parse(localStorage.getItem('cart'));
        localStorage.clear();
        cart={};
        updateCart(cart);
    }
    </script>
{% endblock %}
